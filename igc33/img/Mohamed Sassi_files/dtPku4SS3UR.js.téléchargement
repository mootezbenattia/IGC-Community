if (self.CavalryLogger) { CavalryLogger.start_js(["960As"]); }

__d("AdsMediaDialogFilterConstants",["keyMirror"],(function(a,b,c,d,e,f){"use strict";a=b("keyMirror")({ADD:null,DELETE:null,UPDATE:null});e.exports={FilteringAction:a}}),null);
__d("MessengerSecondarySearchFunnelLogger",["FunnelLogger","MercuryConfig","MessengerSecondarySearchFunnelConstants"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g,h=(g=b("MessengerSecondarySearchFunnelConstants")).FUNNEL_NAME,i=g.ENTRY_SURFACES,j=g.EVENTS,k=g.SEARCH_SURFACES,l=g.MICRO_SESSION_TYPES,m=g.END_ACTIONS,n=new Map(),o=new Map(),p=new Map(),q=new Map(),r=0;function a(a,c,d,e,f){if(!f)return;b("FunnelLogger").startFunnel(h,f);b("FunnelLogger").setFunnelTimeout(h,86400);p.set(f.toString(),c);b("FunnelLogger").appendActionWithPayloadIfNew(h,f,j.START,{search_surface:c,entry_surface:d,thread_fbid:e,client:a});(b("MercuryConfig").ChatComposer||c!==k.OMNIPICKER)&&w(f)}function c(a,c,d,e,f){if(!d)return;var g=o.get(d.toString()),i=n.get(d.toString());i=i?l.QUERY:l.NO_QUERY;g!==null&&(x(d,i),p["delete"](d.toString()));b("FunnelLogger").appendActionWithPayloadIfNew(h,d,j.END,{end_reason:a,action_name:c,thread_fbid:e,is_new_thread:f});b("FunnelLogger").endFunnel(h,d)}function d(a,c){if(!c)return;var d=c.toString(),e=n.get(d),f=p.get(d);!e&&!!a?((b("MercuryConfig").ChatComposer||f===k.BROADCAST||f===k.GROUP_CREATION||f===i.COMPOSER)&&x(c,l.NO_QUERY),w(c)):e&&a===""&&e!==""&&(x(c,l.QUERY),(b("MercuryConfig").ChatComposer||f===k.BROADCAST||f===k.GROUP_CREATION||f===i.COMPOSER)&&w(c));n.set(d,a);b("FunnelLogger").appendActionWithPayload(h,c,j.QUERY_CHANGED,{query_string:a})}function f(a,c,d,e,f,g,i,m){if(!i)return;var r=i.toString(),s=p.get(r),t=o.get(r);q.set(t,!0);b("FunnelLogger").appendActionWithPayload(h,i,j.RESULT_SELECTED,{query_string:e,result_fbid:a,result_type:d,result_index:c,data_source:[f],search_surface:g,micro_session_id:t,selection_type:m});s===k.OMNIPICKER?(x(i,l.QUERY),b("MercuryConfig").ChatComposer?(n.set(r,""),w(i)):n["delete"](r)):e&&s===k.GROUP_CREATION&&(n.set(r,""),x(i,l.QUERY),w(i))}function s(a,c,d){if(!d)return;b("FunnelLogger").appendActionWithPayload(h,d,j.SOURCE_STARTED,{query_string:a,data_source:[c]})}function t(a,c,d,e,f,g){if(!g)return;b("FunnelLogger").appendActionWithPayload(h,g,j.SOURCE_ENDED,{query_string:a,results_count:c,data_source:[d],status:e,result_used:f})}function u(a,c,d,e){if(!e)return;if(c.length===0)return;b("FunnelLogger").appendActionWithPayload(h,e,j.IMPRESSIONS,{query_string:a,impression_list:c})}function v(a,c,d){if(!d)return;b("FunnelLogger").appendActionWithPayload(h,d,j.TOKEN_REMOVED,{deleted_result_id:a,cleared_all_tokens:c})}function w(a){b("FunnelLogger").appendActionWithPayload(h,a,j.MICRO_SESSION_STARTED,{micro_session_id:r}),o.set(a.toString(),r),q.set(r,!1),r+=1}function x(a,c){var d=o.get(a.toString());b("FunnelLogger").appendActionWithPayload(h,a,j.MICRO_SESSION_ENDED,{micro_session_id:d,micro_session_end_reason:q.get(d)?m.RESULT_SELECTED:m.ABANDON,micro_session_type:c});q["delete"](d);o["delete"](a.toString())}function y(a){b("FunnelLogger").appendAction(h,a,j.REENTER_OMNIPICKER)}function z(a){b("FunnelLogger").appendAction(h,a,j.CLICK_OTHER_THREAD)}e.exports={endFunnel:c,impressions:u,queryChanged:d,reenterSearch:y,resultSelected:f,sourceEnded:t,sourceStarted:s,startFunnel:a,tokenRemoved:v,unfocusSearch:z}}),null);